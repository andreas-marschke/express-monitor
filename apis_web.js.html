<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: apis/web.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: apis/web.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
var express = require("express"),
    app = express(),
    http = require("http");

/**
 * Simple Web REST API to access the Monitor state and observe the
 * performance metrics of your application.
 *
 * Exposed API Endpoints are:
 *  - `GET` `/json/state`: returns the entire state object as a JSON Object
 *  - `GET` `/json/uptime`: Get the current uptime in a JS epoch (UNIX Epoch in milliseconds)
 *  - `GET` `/json/stats/counters`: Get all state fields as a JSON Array  wrapped in an JSON object eg. `{ "counter": ["requestCount", "transferredBytes"] }`
 *  - `GET` `/json/stats/counter/:name`: Get the current valueset for a given counter ie. `transferredBytes` (`GET /json/stats/counter/transferredBytes` returns `{ "data": {} }`)
 *
 * Configuration options for this API module is are:
 *  - `port`: TCP port to bind to on the host
 *  - `listen`: IP to listen on
 *
 * @example
 * monitor = require("express-performance-monitor")
 * // Use the monitor.apis.web module to expose the web REST API
 * var manager = new monitor.Manager({
 *   maxRetention: 1000 * 60 * 2,
 *   aggregate: 60,
 *   apis: ["web"],
 *   server: {
 *     web: {
 *       port: 3001,
 *       listen: "0.0.0.0"
 *     }
 *   },
 *   module: {
 *     web: monitor.apis.web
 *   },
 *   customFields: []
 * });
 * @module monitor.apis.web
 */
module.exports = function(manager, config) {
  app.get("/json/state", function(req, res) {
    res.json(manager.getState());
  });

  app.get("/json/stats/uptime", function(req, res) {
    var state = manager.getState();

    res.json({ uptime: (new Date().getTime()) - state.lastStart });
  });

  app.get("/json/stats/counters", function(req, res) {
    var state = manager.getState();

    function isField() {
      return typeof state[v] === "object";
    }
    res.json({counters: Object.keys(state).filter(isField)});
  });

  app.get("/json/stats/counter/:name", function(req, res) {
    var state = manager.getState();
    var name = req.params.name;
    if (state[name] &amp;&amp; typeof state[name] === "object") {
      res.json({data: state[name].data});
    } else {
      res.json({error: "Could not find counter for name: " + name});
    }
  });

  var server = http.createServer(app);
  return {
    start: function() {
      server.listen(config.port, config.listen, function() {
        console.log("Monitoring started, port:", config.port, "on host:", config.listen);
      });
    },
    stop: function() {
      server.close(function() {
        console.log("Stopped minitoring web service");
      });
    },
    active: function() {
      return server.listening;
    }
  };
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Example.html">Example</a></li><li><a href="module-middleware.html">middleware</a></li><li><a href="monitor.apis.module_web.html">web</a></li></ul><h3>Classes</h3><ul><li><a href="Manager.html">Manager</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu Dec 15 2016 08:23:48 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
